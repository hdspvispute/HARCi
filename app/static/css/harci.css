@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== Base / Theme ===== */
@layer base {
  :root {
    --brand-red: #E60027;
    --footer-h: 96px;           /* desktop/tablet default */
  }
  /* Mobile footer taller (chips + input) */
  @media (max-width: 767px) { :root { --footer-h: 200px; } } /* was 160px */
  html, body { height: 100%; }
}

/* ===== Layout Utilities ===== */
@layer utilities {
  .conversation-shell{
    height: calc(var(--app-h, 100dvh) - var(--hdr, 0px));
    min-height: calc(var(--app-h, 100dvh) - var(--hdr, 0px));
    overflow: hidden;
  }
  .aspect-video { aspect-ratio: 16 / 9; }
  .no-callout   { -webkit-touch-callout: none; }
}

/* ===== Components ===== */
@layer components {
  .card { @apply rounded-2xl border border-white/10 bg-neutral-900/40; }

  .btn {
    @apply inline-flex items-center justify-center gap-2 rounded-2xl px-4 py-2.5
           border border-white/10 bg-white/5 text-white hover:bg-white/10
           transition duration-200 active:scale-[.99]
           disabled:opacity-50 disabled:cursor-not-allowed;
  }

  .btn-brand { @apply border-transparent text-white; background: var(--brand-red); }
  .btn-brand:hover { filter: brightness(1.1); }

  .btn-outline { @apply border-white/30 bg-transparent hover:bg-white/10; }
  .btn-plain   { @apply bg-transparent border-transparent text-white/70 hover:text-white hover:bg-white/10; }

  .btn-circle {
    @apply h-14 w-14 sm:h-16 sm:w-16 rounded-full border-0
           flex items-center justify-center shadow-lg
           active:scale-[.99] disabled:opacity-50;
    background: var(--brand-red);
  }

  .chip {
    @apply px-3 py-1.5 rounded-full bg-white/5 border border-white/10 text-sm
           hover:bg-white/10 whitespace-nowrap;
  }

  .input {
    @apply w-full rounded-2xl px-3 py-2.5 bg-white/5 text-white placeholder-white/50
           border border-white/10 focus:outline-none focus:ring-2
           focus:ring-[var(--brand-red)] focus:border-transparent
           disabled:opacity-50 disabled:cursor-not-allowed;
  }

  /* ========= Strong Inactive/Disabled styles (Tailwind-only) ========= */
  /* Buttons — general (high contrast difference) */
  .btn:disabled,
  .btn[aria-disabled="true"] {
    @apply opacity-40 grayscale saturate-0 contrast-75 brightness-75
           pointer-events-none shadow-none;
    transform: none; /* neutralize active scale */
  }

  /* Brand buttons — clearly not tappable when disabled */
  .btn-brand:disabled,
  .btn-brand[aria-disabled="true"] {
    @apply opacity-40 ring-1 ring-white/15 shadow-none;
  }

  /* Outline/Plain buttons — soften text/borders clearly */
  .btn-outline:disabled,
  .btn-outline[aria-disabled="true"],
  .btn-plain:disabled,
  .btn-plain[aria-disabled="true"] {
    @apply text-white/45 border-white/20 bg-white/5;
  }

  /* Chips — dashed, muted, slightly darker */
  .chip:disabled,
  .chip[aria-disabled="true"] {
    @apply bg-neutral-700/30 border-dashed border-white/25 text-white/55
           pointer-events-none;
  }

  /* Inputs — darker well + faint placeholder */
  .input:disabled,
  .input[aria-disabled="true"] {
    @apply bg-neutral-700/20 text-white/60 border-white/15;
  }
  .input:disabled::placeholder,
  .input[aria-disabled="true"]::placeholder { @apply text-white/30; }

  /* Mic button — swap brand red for neutral gray when disabled */
  #btnHoldMic:disabled,
  #btnHoldMic[aria-disabled="true"] {
    @apply bg-neutral-700 ring-2 ring-white/20 border border-dashed border-white/25
           opacity-70 grayscale pointer-events-none;
  }
  #btnHoldMic:disabled svg,
  #btnHoldMic[aria-disabled="true"] svg { @apply opacity-80; }

  /* =========================
     Global UI state visuals
     ========================= */
  /* Pre-session or ended */
  body.ui-inactive footer,
  body.ui-inactive #quickChips,
  body.ui-inactive #quickChipsDesk,
  body.ui-inactive #askForm,
  body.ui-inactive #askFormDesk,
  body.ui-inactive #btnHoldMic {
    @apply opacity-50 grayscale contrast-75;
  }

  /* Thinking/Starting/Processing… */
  body.ui-busy footer,
  body.ui-busy #quickChips,
  body.ui-busy #quickChipsDesk,
  body.ui-busy #askForm,
  body.ui-busy #askFormDesk,
  body.ui-busy #btnHoldMic {
    @apply opacity-45 grayscale contrast-75 pointer-events-none;
  }
}

/* ===== States / Effects ===== */
body.idle #remoteVideo { filter: brightness(.88) saturate(.95); }

/* Optional: dim chip row when any chip is disabled (busy vibe) */
#quickChips:has(button:disabled),
#quickChipsDesk:has(button:disabled) {
  filter: grayscale(100%) brightness(.9);
}

/* ===== Prose tweaks ===== */
.prose h1 { @apply text-xl font-bold mt-2 mb-1; }
.prose h2 { @apply text-lg font-semibold mt-2 mb-1; }
.prose h3 { @apply text-base font-semibold mt-2 mb-1; }
.prose ul { @apply list-disc ml-6; }
.prose p  { @apply leading-relaxed; }

/* ===== Media surfaces ===== */
#remoteVideo { @apply w-full h-full object-cover bg-black; }
#briefImage  { @apply w-full object-cover; }

/* ===== Status dot & mic hardening ===== */
#statusDot { background: #10B981; }
#btnHoldMic { -webkit-touch-callout: none; }

/* ========================================================================== */
/*        HARD LAYOUT: lock viewport, fixed header/footer, single scroll       */
/* ========================================================================== */

/* No page scroll anywhere */
html, body { overflow: hidden; }
body { height: 100dvh; }

/* Header fixed (assumes h-16 = 4rem set in markup) */
header { position: fixed; top: 0; left: 0; right: 0; z-index: 50; height: 4rem; }

/* Main fills device height under header; no scroll in main */
main { padding-top: 4rem; height: calc(100dvh - 4rem); overflow: hidden; }

/* Footer fixed at bottom; height responsive via --footer-h */
footer { position: fixed; left: 0; right: 0; bottom: 0; height: var(--footer-h); z-index: 9999; }

/* The guide content wrapper inside <main> must subtract footer height */
main > *:first-child { height: calc(100% - var(--footer-h)); overflow: hidden; }

/* Only the briefing SECTION scrolls (not #briefing itself) */
section.briefing-scroll { overflow: auto; }
#briefing { overflow: visible; max-height: none; }

/* Footer internals: Start pinned left; mic centered – actual lifting is done by the frame inset in HTML */
footer .btn#btnSessionToggle {
  position: absolute; left: 1rem; top: 50%; transform: translateY(-50%);
}
footer #btnHoldMic {
  position: absolute; /* fixed: was 'a' */
}

/* Optional: hint on the video too while busy */
body.ui-busy #remoteVideo { filter: brightness(.85) saturate(.95); }
