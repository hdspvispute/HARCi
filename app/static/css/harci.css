@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== Base / Theme ===== */
@layer base {
  :root {
    --brand-red: #E60027;

    /* Taller mobile footer to fit big mic + chips comfortably */
    --footer-h: 160px;

    /* iOS safe areas (used by sticky footer spacing) */
    --sai-b: env(safe-area-inset-bottom);
    --sai-t: env(safe-area-inset-top);
  }
  @media (min-width: 768px) { :root { --footer-h: 120px; } }

  html, body { height: 100%; }
  /* Kill the blue tap highlight on iOS/Android */
  html { -webkit-tap-highlight-color: transparent; }
}

/* ===== Utilities ===== */
@layer utilities {
  .aspect-video { aspect-ratio: 16 / 9; }
  .no-callout   { -webkit-touch-callout: none; }
  .no-select    { -webkit-user-select: none; user-select: none; }
  .tap-manipulation { touch-action: manipulation; } /* prevents double-tap zoom */
  .conversation-shell{
    height: calc(var(--app-h, 100dvh) - var(--hdr, 0px));
    min-height: calc(var(--app-h, 100dvh) - var(--hdr, 0px));
    overflow: hidden;
  }

  /* Hide scrollbars for horizontal chip rows */
  .scrollbar-none { -ms-overflow-style: none; scrollbar-width: none; }
  .scrollbar-none::-webkit-scrollbar { display: none; }
}

/* ===== Components (polished) ===== */
@layer components {
  .card { @apply rounded-2xl border border-white/10 bg-neutral-900/40; }

  .btn {
    @apply inline-flex items-center justify-center gap-2 rounded-2xl px-4 py-2.5
           border border-white/10 bg-white/5 text-white hover:bg-white/10
           transition duration-200 active:scale-[.99]
           disabled:opacity-50 disabled:cursor-not-allowed
           no-select no-callout tap-manipulation;
    line-height: 1; /* crisply centers icons + labels */
  }

  .btn-brand { @apply border-transparent text-white; background: var(--brand-red); }
  .btn-brand:hover { filter: brightness(1.08); }

  .btn-outline { @apply border-white/30 bg-transparent hover:bg-white/10; }
  .btn-plain   { @apply bg-transparent border-transparent text-white/70 hover:text-white hover:bg-white/10; }

  /* Large rectangular mic: readable, tappable, premium */
  .btn-mic-rect {
    @apply rounded-xl h-12 w-[min(100%,32rem)] md:h-14 md:w-[22rem]
           text-sm md:text-base font-semibold shadow-lg
           no-select no-callout tap-manipulation;
    background: var(--brand-red);
  }
  /* Pressed micro-state (JS toggles .is-pressed during hold) */
  /* Do not clobber transforms on generic rectangular buttons */
.btn-mic-rect.is-pressed { filter: brightness(0.98); }

/* The footer mic is absolutely centered; preserve its translate(-50%,-50%) */
#btnHoldMic.is-pressed {
  transform: translate(-50%, -50%) scale(0.995) translateY(1px);
}

  .chip {
    @apply px-3 py-1.5 rounded-full bg-white/5 border border-white/10 text-sm
           hover:bg-white/10 whitespace-nowrap
           no-select no-callout tap-manipulation;
  }

  .input {
    @apply w-full rounded-2xl px-3 py-2.5 bg-white/5 text-white placeholder-white/50
           border border-white/10 focus:outline-none focus:ring-2
           focus:ring-[var(--brand-red)] focus:border-transparent
           disabled:opacity-50 disabled:cursor-not-allowed;
  }

  /* ========= Strong Inactive/Disabled visuals ========= */
.btn:disabled,
.btn[aria-disabled="true"],
.btn-mic-rect:disabled,
.btn-mic-rect[aria-disabled="true"] {
  @apply opacity-40 grayscale saturate-0 contrast-75 brightness-75 pointer-events-none;
  /* IMPORTANT: do NOT reset transform; mic uses translate(-50%,-50%) to stay centered */
  box-shadow: none;
}

/* Keep distinct variants */
.btn-brand:disabled,
.btn-brand[aria-disabled="true"] {
  @apply ring-1 ring-white/15;
}
.btn-outline:disabled,
.btn-outline[aria-disabled="true"],
.btn-plain:disabled,
.btn-plain[aria-disabled="true"] {
  @apply text-white/45 border-white/20 bg-white/5;
}
.chip:disabled,
.chip[aria-disabled="true"] {
  @apply bg-neutral-700/30 border-dashed border-white/25 text-white/55 pointer-events-none;
}
.input:disabled,
.input[aria-disabled="true"] { @apply bg-neutral-700/20 text-white/60 border-white/15; }
.input:disabled::placeholder,
.input[aria-disabled="true"]::placeholder { @apply text-white/30; }

  /* ===== Global UI state overlays (body classes set by JS) ===== */
  body.ui-inactive footer,
  body.ui-inactive #quickChips, body.ui-inactive #quickChipsDesk,
  body.ui-inactive #askForm,    body.ui-inactive #askFormDesk,
  body.ui-inactive #btnHoldMic {
    @apply opacity-50 grayscale contrast-75;
  }

  body.ui-busy footer,
  body.ui-busy #quickChips, body.ui-busy #quickChipsDesk,
  body.ui-busy #askForm,    body.ui-busy #askFormDesk,
  body.ui-busy #btnHoldMic {
    @apply opacity-45 grayscale contrast-75 pointer-events-none;
  }

  /* Subtle busy scrim so the whole app reads “working” (without hiding content) */
  body.ui-busy::after {
    content: "";
    position: fixed; inset: 0;
    background: radial-gradient(120% 120% at 50% 30%, rgba(0,0,0,0) 0%, rgba(0,0,0,0.14) 100%);
    pointer-events: none;
    z-index: 40; /* under header(50) and footer(9999) */
  }

  /* ===== Chip scrollers with fade edges ===== */
  .chip-scroll {
    @apply overflow-x-auto scrollbar-none;
    -webkit-mask-image: linear-gradient(to right, transparent 0, #000 24px, #000 calc(100% - 24px), transparent);
            mask-image: linear-gradient(to right, transparent 0, #000 24px, #000 calc(100% - 24px), transparent);
  }
}

/* ===== States / Effects ===== */
body.idle #remoteVideo { filter: brightness(.88) saturate(.95); }

/* Dim chip row when any chip is disabled (reinforce “busy”) */
#quickChips:has(button:disabled),
#quickChipsDesk:has(button:disabled) { filter: grayscale(100%) brightness(.9); }

/* ===== Prose tweaks ===== */
.prose h1 { @apply text-xl font-bold mt-2 mb-1; }
.prose h2 { @apply text-lg font-semibold mt-2 mb-1; }
.prose h3 { @apply text-base font-semibold mt-2 mb-1; }
.prose ul { @apply list-disc ml-6; }
.prose p  { @apply leading-relaxed; }

/* ===== Media surfaces ===== */
#remoteVideo { @apply w-full h-full object-cover bg-black; }
#briefImage  { @apply w-full object-cover; }

/* ===== Status dot & mic hardening ===== */
#statusDot { background: #10B981; }
#btnHoldMic { -webkit-touch-callout: none; }

/* ========================================================================== */
/*        HARD LAYOUT: lock viewport, fixed header/footer, single scroll       */
/* ========================================================================== */
html, body { overflow: hidden; }
body       { height: 100dvh; }

/* Header fixed (assumes 4rem) */
header     { position: fixed; top: 0; left: 0; right: 0; z-index: 50; height: 4rem; padding-top: max(0px, var(--sai-t)); }

/* Main fills under header; only the briefing section scrolls */
main       { padding-top: 4rem; height: calc(100dvh - 4rem); overflow: hidden; }

/* Footer fixed; include safe-area inset for notched phones */
footer     { position: fixed; left: 0; right: 0; bottom: 0; height: calc(var(--footer-h) + var(--sai-b)); z-index: 9999; }
footer .footer-inner { padding-bottom: max(0.25rem, var(--sai-b)); } /* give a little breathing room */

/* Subtract footer height from the main content wrapper */
main > *:first-child { height: calc(100% - var(--footer-h)); overflow: hidden; }

/* Only the briefing SECTION scrolls */
section.briefing-scroll { overflow: auto; -webkit-overflow-scrolling: touch; }
#briefing { overflow: visible; max-height: none; }

/* Optional: also hint on the video while busy */
body.ui-busy #remoteVideo { filter: brightness(.85) saturate(.95); }
