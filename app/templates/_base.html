<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="{{ cfg.brandRed or '#E60027' }}">
  <link rel="manifest" href="{{ url_for('static', path='manifest.webmanifest') }}">
  <title>{% block title %}HARCi{% endblock %}</title>

  <!-- Avoid favicon 404s with an inline icon -->
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><rect width="32" height="32" rx="6" fill="{{ (cfg.brandRed or "#E60027") | replace("#","%23") }}"/></svg>'>

  <link rel="stylesheet" href="{{ url_for('static', path='css/harci.css') }}?v=11" />
  <style>
    :root { --brand-red: {{ cfg.brandRed or '#E60027' }}; }
  </style>

  <!-- Microsoft Cognitive Services Speech SDK (load once, globally) -->
  <script src="https://aka.ms/csspeech/jsbrowserpackageraw" defer></script>
</head>
<body class="min-h-full bg-neutral-900 text-neutral-100">
  <!-- Header -->
  <header class="w-full border-b border-white/10 bg-neutral-950/60 backdrop-blur">
    <div class="mx-auto max-w-6xl px-4 py-3 flex items-center gap-3">
      <div class="w-8 h-8 rounded bg-[var(--brand-red)]"></div>
      <div class="text-lg font-semibold tracking-wide">HARCi â€“ Hitachi AI Concierge</div>
      {% block header_right %}{% endblock %}
    </div>
  </header>

  <!-- Page content -->
  <main class="mx-auto max-w-6xl px-4 py-6">
    {% block content %}{% endblock %}
  </main>

  <!-- Global scripts (single load, ordered, deferred) -->
  <script src="{{ url_for('static', path='js/logger.js') }}?v=11" defer></script>
  <script src="{{ url_for('static', path='js/api.js') }}?v=11" defer></script>

  <!-- Load lifecycle + UI shims BEFORE avatar_rtc uses setStatus/speak -->
  <script src="{{ url_for('static', path='js/harci_lifecycle_patch.js') }}?v=11" defer></script>
  <script src="{{ url_for('static', path='js/ui_bindings.js') }}?v=11" defer></script>

  <!-- Idle timer after UI is ready -->
  <script src="{{ url_for('static', path='js/idle.js') }}?v=11" defer></script>

  <!-- Voice/AV stack (only loaded once globally; guide page hooks into them) -->
  <script src="{{ url_for('static', path='js/avatar_rtc.js') }}?v=11" defer></script>
  <script src="{{ url_for('static', path='js/stt.js') }}?v=11" defer></script>
  <script src="{{ url_for('static', path='js/earcon.js') }}?v=11" defer></script>

  {% block extra_scripts %}{% endblock %}
</body>
</html>
